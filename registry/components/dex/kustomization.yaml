apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - application.yaml
  - namespace.yaml
  - secret.yaml

patches:
  - target:
      group: argoproj.io
      version: v1alpha1
      kind: Application
      name: dex
    patch: |-
      - op: replace
        path: /spec/source/helm/valuesObject/ingress/hosts/0/host
        value: oidc.dev.simonemms.com
      - op: replace
        path: /spec/source/helm/valuesObject/ingress/tls/0/hosts/0
        value: oidc.dev.simonemms.com
      - op: replace
        path: /spec/source/helm/valuesObject/ingress/annotations/cert-manager.io~1cluster-issuer
        value: letsencrypt-staging
  - target:
      group: generators.external-secrets.io
      version: v1alpha1
      kind: Fake
      name: oidc-settings
    patch: |-
      - op: replace
        path: /spec/data/base_url
        value: https://oidc.dev.simonemms.com
      - op: replace
        path: /spec/data/argocd_url
        value: https://argocd.dev.simonemms.com
      - op: replace
        path: /spec/data/grafana_url
        value: https://grafana.dev.simonemms.com
      - op: replace
        path: /spec/data/homepage_url
        value: https://homepage.dev.simonemms.com
